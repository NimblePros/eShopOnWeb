@page "/users"
@attribute [Authorize(Roles = BlazorShared.Authorization.Constants.Roles.ADMINISTRATORS)]
@inherits BlazorAdmin.Helpers.BlazorComponent
@namespace BlazorAdmin.Pages.UserPage
@using Radzen

<PageTitle>eShopOnWeb Admin: Manage Users</PageTitle>

<h1>Manage Users</h1>

@if (_users == null)
{
    <RadzenProgressBar Mode="ProgressBarMode.Indeterminate" Style="width:100%" />
}
else
{
    <p class="esh-link-wrapper">
        <RadzenButton Text="Create New" ButtonStyle="ButtonStyle.Primary" Click="CreateClick" />
    </p>

    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th>Email</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody class="cursor-pointer">
        @foreach (var user in _users)
        {
            <tr>
                <td>@user.Email</td>
                <td>
                    @if (_currentUser is null || _currentUser.Identity is null)
                    {
                        <p>Unknown current user</p>
                    }
                    else if (user.UserName != _currentUser.Identity.Name && user.UserName != "admin@microsoft.com")
                    {
                        <RadzenButton Text="Edit" ButtonStyle="ButtonStyle.Primary" Click="@(() => EditClick(user.Id))" Style="margin-right:5px" />
                        <RadzenButton Text="Delete" ButtonStyle="ButtonStyle.Danger" Click="@(() => DeleteClick(user.Id, user.UserName))" />
                    }
                </td>
            </tr>
        }
        </tbody>
    </table>

    <Create OnSaveClick="ReloadUsers" @ref="CreateComponent"></Create>
    <Delete OnSaveClick="ReloadUsers" @ref="DeleteComponent"></Delete>
    <Edit OnSaveClick="ReloadUsers" @ref="EditComponent"></Edit>
}