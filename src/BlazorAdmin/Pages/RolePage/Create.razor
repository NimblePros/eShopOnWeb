@using BlazorAdmin.Interfaces
@using BlazorAdmin.Models
@inject ILogger<Create> Logger
@inject IRoleManagementService RoleManagementService
@inject DialogService DialogService

@namespace BlazorAdmin.Pages.RolePage

<RadzenDialog @bind-Visible="_showDialog" Width="500px">
    <ChildContent>
        <DialogTitle>
            Create Role
        </DialogTitle>

        <DialogContent>
            @if (_item == null)
            {
                <RadzenProgressBar Mode="ProgressBarMode.Indeterminate" />
            }
            else
            {
                <RadzenTemplateForm TItem="CreateRoleRequest" Data="@_item" Submit="@CreateClick">
                    <ChildContent Context="formCtx">
                        <RadzenFieldset>
                            <RadzenLabel Text="Name" Component="Name" />
                            <RadzenTextBox @bind-Value="_item.Name" Name="Name" Style="width:100%" />
                            <RadzenRequiredValidator Component="Name" Text="Name is required" />
                        </RadzenFieldset>
                    </ChildContent>
                </RadzenTemplateForm>
            }
        </DialogContent>

        <DialogActions>
            <RadzenButton Text="Cancel" ButtonStyle="ButtonStyle.Secondary" Click="@Close" />
            <RadzenButton Text="Create" ButtonStyle="ButtonStyle.Primary" Click="@CreateClick" />
        </DialogActions>
    </ChildContent>
</RadzenDialog>

@code {
    [Parameter] public EventCallback<string> OnSaveClick { get; set; }

    private CreateRoleRequest _item = new CreateRoleRequest();
    private bool _showDialog = false;

    public async Task Open()
    {
        Logger.LogInformation("Now loading... /Roles/Create");
        _item = new CreateRoleRequest();
        _showDialog = true;
    }

    private async Task Close()
    {
        _showDialog = false;
    }

    private async Task CreateClick()
    {
        var result = await RoleManagementService.Create(_item);
        if (result != null)
        {
            Logger.LogInformation("Created Role {id}", result.Role.Id);
            await OnSaveClick.InvokeAsync(null);
            await Close();
        }
    }
}