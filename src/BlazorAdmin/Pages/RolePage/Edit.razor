@using BlazorAdmin.Interfaces
@using BlazorAdmin.Models
@using Microsoft.AspNetCore.Identity
@inject ILogger<Edit> Logger
@inject IRoleManagementService RoleManagementService
@inject DialogService DialogService

@namespace BlazorAdmin.Pages.RolePage

<RadzenDialog Visible="@_showDialog" Width="500px" CloseDialog="@Close">
    <ChildContent>
        <DialogTitle>
            Edit @_item?.Name
        </DialogTitle>

        <DialogContent>
            @if (_item == null)
            {
                <RadzenProgressBar Mode="ProgressBarMode.Indeterminate"></RadzenProgressBar>
            }
            else
            {
                <EditForm Model="_item" OnValidSubmit="@SaveClick">
                    <DataAnnotationsValidator />
                    <RadzenFieldset Text="Role Details">
                        <RadzenTextBox @bind-Value="_item.Name" Style="width:100%" Name="Name" />
                        <ValidationMessage For="(() => _item.Name)" />
                    </RadzenFieldset>
                </EditForm>
            }
        </DialogContent>

        <DialogActions>
            <RadzenButton Text="Cancel" ButtonStyle="ButtonStyle.Secondary" Click="@Close" />
            <RadzenButton Text="Save" ButtonStyle="ButtonStyle.Primary" Click="@SaveClick" />
        </DialogActions>
    </ChildContent>
</RadzenDialog>

@code {
    private bool _showDialog = false;
    private IdentityRole _item = new IdentityRole();

    [Parameter]
    public EventCallback<string> OnSaveClick { get; set; }

    public async Task Open(string id)
    {
        Logger.LogInformation("Now loading... /Roles/Edit/{Id}", id);
        _item = (await RoleManagementService.GetById(id)).Role;

        _showDialog = true;
        StateHasChanged();
    }

    private async Task Close()
    {
        _showDialog = false;
    }

    private async Task SaveClick()
    {
        await RoleManagementService.Edit(_item);
        Logger.LogInformation("Updated Role Id: {Id}", _item.Id);
        await OnSaveClick.InvokeAsync(null);
        await Close();
    }
}